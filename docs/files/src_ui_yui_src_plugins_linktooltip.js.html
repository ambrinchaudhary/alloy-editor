<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/ui/yui/src/plugins/linktooltip.js - AlloyEditor</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="AlloyEditor"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AlloyEditor.html">AlloyEditor</a></li>
            
                <li><a href="../classes/ButtonA.html">ButtonA</a></li>
            
                <li><a href="../classes/ButtonBase.html">ButtonBase</a></li>
            
                <li><a href="../classes/ButtonEm.html">ButtonEm</a></li>
            
                <li><a href="../classes/ButtonH1.html">ButtonH1</a></li>
            
                <li><a href="../classes/ButtonH2.html">ButtonH2</a></li>
            
                <li><a href="../classes/ButtonImage.html">ButtonImage</a></li>
            
                <li><a href="../classes/ButtonLeft.html">ButtonLeft</a></li>
            
                <li><a href="../classes/ButtonRight.html">ButtonRight</a></li>
            
                <li><a href="../classes/ButtonStrong.html">ButtonStrong</a></li>
            
                <li><a href="../classes/ButtonTwitter.html">ButtonTwitter</a></li>
            
                <li><a href="../classes/ButtonU.html">ButtonU</a></li>
            
                <li><a href="../classes/CKEDITOR.Link.html">CKEDITOR.Link</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.dropimages.html">CKEDITOR.plugins.dropimages</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.linktooltip.html">CKEDITOR.plugins.linktooltip</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.placeholder.html">CKEDITOR.plugins.placeholder</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.selectionregion.html">CKEDITOR.plugins.selectionregion</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.uicore.html">CKEDITOR.plugins.uicore</a></li>
            
                <li><a href="../classes/CKEDITOR.plugins.uiloader.html">CKEDITOR.plugins.uiloader</a></li>
            
                <li><a href="../classes/CKEDITOR.tools.html">CKEDITOR.tools</a></li>
            
                <li><a href="../classes/LinkTooltip.html">LinkTooltip</a></li>
            
                <li><a href="../classes/ToolbarAdd.html">ToolbarAdd</a></li>
            
                <li><a href="../classes/ToolbarAddItems.html">ToolbarAddItems</a></li>
            
                <li><a href="../classes/ToolbarBase.html">ToolbarBase</a></li>
            
                <li><a href="../classes/ToolbarImage.html">ToolbarImage</a></li>
            
                <li><a href="../classes/ToolbarStyles.html">ToolbarStyles</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/ui/yui/src/plugins/linktooltip.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function() {
    &#x27;use strict&#x27;;

    if (CKEDITOR.plugins.get(&#x27;linktooltip&#x27;)) {
        return;
    }

    YUI.add(&#x27;linktooltip&#x27;, function(Y) {
        var Lang = Y.Lang,

            /**
             * The LinkTooltip class provides functionality for showing tooltip over link elements in editor.
             * The class will be also registered as CKEDITOR plugin - {{#crossLink &quot;CKEDITOR.plugins.linktooltip&quot;}}{{/crossLink}}
             *
             * @class LinkTooltip
             */
            LinkTooltip = Y.Base.create(&#x27;linktooltip&#x27;, Y.Widget, [Y.WidgetPosition, Y.WidgetPositionConstrain, Y.WidgetAutohide], {
                /**
                 * Initializer lifecycle implementation for the LinkTooltip class.
                 *
                 * @method initializer
                 * @protected
                 * @param config {Object} Configuration object literal for the editor
                 */
                initializer: function() {
                    this._eventHandles = [];
                },

                /**
                 * Destructor lifecycle implementation for the LinkTooltip class. Destroys the iattached event listeners.
                 *
                 * @method destructor
                 * @protected
                 */
                destructor: function() {
                    (new Y.EventHandle(this._eventHandles)).detach();
                },

                /**
                 * Renders the link tooltip node on contentBox.
                 *
                 * @method renderUI
                 * @protected
                 */
                renderUI: function() {
                    var content;

                    content = Y.Node.create(this.TPL_CONTENT);

                    this.get(&#x27;contentBox&#x27;).appendChild(content);

                    this._linkPreview = content.one(&#x27;.link-preview&#x27;);
                },

                /**
                 * Attaches event listeners such as mouseenter on link elements. Links, which have
                 * &quot;data-cke-default-link&quot; attribute will be ignored. These links are considered as
                 * internal; they are being created by automatically when user triggers link creation.
                 * See {{#crossLink &quot;ButtonA/_onClick:method&quot;}}{{/crossLink}} for more information.
                 *
                 * @method bindUI
                 * @protected
                 */
                bindUI: function() {
                    var editor;

                    this._bindBBMouseEnter();

                    editor = this.get(&#x27;editor&#x27;);

                    this._eventHandles.push(
                        Y.one(editor.element.$).delegate(&#x27;mouseenter&#x27;, this._onLinkMouseEnter, &#x27;a[href]:not([data-cke-default-link])&#x27;, this, editor)
                    );

                    this.get(&#x27;boundingBox&#x27;).on(&#x27;clickoutside&#x27;, this._onClickOutside, this);
                },

                /**
                 * Adds mouseleave listener to the boundingBox.
                 *
                 * @method _bindBBMouseLeave
                 * @protected
                 */
                _bindBBMouseLeave: function() {
                    var boundingBox;

                    boundingBox = this.get(&#x27;boundingBox&#x27;);

                    this._bbMouseLeaveHandle = boundingBox.once(&#x27;mouseleave&#x27;, this._onBBMouseLeave, this);
                },

                /**
                 * Adds mouseenter listener to the boundingBox.
                 *
                 * @method _bindBBMouseEnter
                 * @protected
                 */
                _bindBBMouseEnter: function() {
                    var boundingBox;

                    boundingBox = this.get(&#x27;boundingBox&#x27;);

                    this._bbMouseEnterHandle = boundingBox.on(&#x27;mouseenter&#x27;, this._onBBMouseEnter, this);
                },

                /**
                 * Hides the linktooltip container after some timeout, specified by
                 * {{#crossLink &quot;LinkTooltip/hideTimeout:attribute&quot;}}{{/crossLink}} attribute.
                 *
                 * @method _attachHiddenHandle
                 * @protected
                 */
                _attachHiddenHandle: function() {
                    var instance = this;

                    this._hideHandle = setTimeout(
                        function() {
                            instance.hide();
                        },
                        this.get(&#x27;hideTimeout&#x27;)
                    );
                },

                /**
                 * Calculates and returns the most appropriate position where link tooltip should appear.
                 * The position depends on the specified {{#crossLink &quot;LinkTooltip/gutter:attribute&quot;}}{{/crossLink}},
                 * and on the fact if the link occupies more than one line in the editor.
                 *
                 * @method _getXY
                 * @protected
                 * @param {Number} x Point X in page coordinates.
                 * @param {Number} y Point Y in page coordinates.
                 * @param {Node} y The link over which the tooltip should be shown.
                 * returns {Array} An Array with the most appropriate x and y points in page coordinates.
                 */
                _getXY: function(x, y, link) {
                    var gutter,
                        i,
                        line,
                        lineHeight,
                        lines,
                        region;

                    lineHeight = parseInt(link.getComputedStyle(&#x27;lineHeight&#x27;), 10);

                    gutter = this.get(&#x27;gutter&#x27;);

                    region = link.get(&#x27;region&#x27;);

                    gutter = gutter.top;

                    if (Lang.isNumber(lineHeight)) {
                        line = 1;

                        lines = Math.ceil((region.bottom - region.top) / lineHeight);

                        for (i = 1; i &lt;= lines; i++) {
                            if (y &lt; region.top + lineHeight * i) {
                                break;
                            }

                            ++line;
                        }

                        y = region.top + line * lineHeight + gutter;
                    } else {
                        y = region.bottom + gutter;
                    }

                    return [x, y];
                },

                /**
                 * Handles mouse enter event on the boundingBox.
                 * Clears any already started hide handle and attaches mouse leave listener to the boundingBox.
                 *
                 * @method _onBBMouseEnter
                 * @protected
                 */
                _onBBMouseEnter: function() {
                    clearTimeout(this._hideHandle);

                    this._bindBBMouseLeave();
                },

                /**
                 * Handles mouse leave event on the boundingBox.
                 * Clears any already started hide handle and attaches it again.
                 *
                 * @method _onBBMouseEnter
                 * @protected
                 */
                _onBBMouseLeave: function() {
                    clearTimeout(this._hideHandle);

                    this._attachHiddenHandle();
                },

                /**
                 * Hides the tooltip on clicking outside of the boundingBox.
                 *
                 * @method _onClickOutside
                 * @protected
                 */
                _onClickOutside: function() {
                    this.hide();
                },

                /**
                 * Reads the link href, updates tooltip content with the read value,
                 * shows the tooltip and attaches mouse leave listener on the boundingBox.
                 *
                 * @method _onLinkMouseEnter
                 * @protected
                 * @param {EventFacade} event Event that triggered when user positioned the mouse over the link.
                 */
                _onLinkMouseEnter: function(event) {
                    var instance = this,
                        link,
                        linkText,
                        xy;

                    if (this._editMode) {
                        return;
                    }

                    clearTimeout(instance._hideHandle);

                    link = event.currentTarget;

                    linkText = link.getAttribute(&#x27;href&#x27;);

                    this._linkPreview.setAttribute(&#x27;href&#x27;, linkText);

                    this._linkPreview.set(&#x27;innerHTML&#x27;, Y.Escape.html(linkText));

                    instance.show();

                    xy = instance._getXY(event.pageX, event.pageY, link);

                    instance.set(&#x27;xy&#x27;, xy);

                    link.once(&#x27;mouseleave&#x27;, function() {
                        clearTimeout(instance._hideHandle);

                        instance._attachHiddenHandle();
                    });
                },

                BOUNDING_TEMPLATE: &#x27;&lt;div class=&quot;alloy-editor-tooltip-link&quot;&gt;&lt;/div&gt;&#x27;,

                TPL_CONTENT: &#x27;&lt;div class=&quot;link-container&quot;&gt;&#x27; +
                    &#x27;&lt;span class=&quot;icon-link-container&quot;&gt;&#x27; +
                    &#x27;&lt;i class=&quot;alloy-editor-icon-link&quot;&gt;&lt;/i&gt;&#x27; +
                    &#x27;&lt;/span&gt;&#x27; +
                    &#x27;&lt;a class=&quot;link-preview&quot; target=&quot;_blank&quot;&gt;&lt;/a&gt;&#x27; +
                    &#x27;&lt;/div&gt;&#x27;
            }, {
                ATTRS: {
                    /**
                     * Specifies whether the toolbar show be constrained to some node or to the viewport.
                     *
                     * @attribute constrain
                     * @default true (will be constrained to the viewport)
                     * @type Boolean
                     */
                    constrain: {
                        validator: Lang.isBoolean,
                        value: true
                    },

                    /**
                     * Contains the native editor implementation.
                     *
                     * @attribute editor
                     * @default true
                     * @type Object
                     */
                    editor: {
                        validator: Y.Lang.isObject
                    },

                    /**
                     * Specifies the gutter of the tooltip. The gutter object contains the top and left
                     * offsets from the point, where the tooltip is supposed to appear.
                     *
                     * @attribute gutter
                     * @default {
                     *   left: 0,
                     *   top: 0
                     * }
                     * @type Object
                     */
                    gutter: {
                        validator: Lang.isObject,
                        value: {
                            left: 0,
                            top: 0
                        }
                    },

                    /**
                     * Specifies the timeout after which the link tooltip will be hidden.
                     *
                     * @attribute hideTimeout
                     * @default 2000 (sec)
                     * @type Number
                     */
                    hideTimeout: {
                        validator: Lang.isNumber,
                        value: 2000
                    }
                }
            });

        Y.LinkTooltip = LinkTooltip;

    }, &#x27;&#x27;, {
        requires: [&#x27;dom-screen&#x27;, &#x27;escape&#x27;, &#x27;event-outside&#x27;, &#x27;node-event-delegate&#x27;, &#x27;event-mouseenter&#x27;, &#x27;widget-base&#x27;, &#x27;widget-position&#x27;, &#x27;widget-position-constrain&#x27;, &#x27;widget-autohide&#x27;]
    });

    /**
     * CKEDITOR plugin which allows displaying tooltip over links in the editor.
     * Internally it uses {{#crossLink &quot;LinkTooltip&quot;}}{{/crossLink}}. You may specify all
     * properties which {{#crossLink &quot;LinkTooltip&quot;}}{{/crossLink}} accepts via editor.config.linktooltip property.
     *
     * @class CKEDITOR.plugins.linktooltip
     */
    CKEDITOR.plugins.add(
        &#x27;linktooltip&#x27;, {
            init: function(editor) {
                YUI().use(&#x27;linktooltip&#x27;, function(Y) {
                    var config,
                        tooltip;

                    config = Y.merge({
                        editor: editor,
                        visible: false
                    }, editor.config.linktooltip);

                    tooltip = new Y.LinkTooltip(config).render();

                    editor.on(&#x27;destroy&#x27;, function() {
                        tooltip.destroy();
                    });
                });
            }
        }
    );
}());
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
